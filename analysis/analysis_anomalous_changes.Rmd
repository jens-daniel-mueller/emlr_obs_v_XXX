---
title: "Analysis of cant estimates"
author: "Jens Daniel MÃ¼ller"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  workflowr::wflow_html:
    number_sections: true
    toc_depth: 3
    toc_float:
      collapsed: false
editor_options:
  chunk_output_type: console
params:
  Version_ID: "v_XXX"
---

```{r parent, child = "/nfs/kryo/work/jenmueller/emlr_cant/utilities/setup.Rmd"}
# this chunk runs the code stored in setup.Rmd
# if required, please refer to instructions given here:
# https://jdblischak.github.io/workflowr/articles/wflow-07-common-code.html
```

```{r read_params_local, include = FALSE}

if (params$Version_ID == "v_XXX") {
  params_local <-
    read_rds(here::here("data/auxillary", "params_local.rds"))
  
} else {
  params_local <-
    read_rds(
      file = paste(path_root, "observations",
                   params$Version_ID,
                   "data/params_local.rds",
                   sep = "/")
    )
}

```

```{r define_paths, include = FALSE}

# only path_observations needs to be changed to model
path_observations <-
  paste(path_root, "/observations/", sep = "")

path_preprocessing    <-
  paste(path_observations, "preprocessing/", sep = "")

path_preprocessing_model    <-
  paste(path_root, "/model/preprocessing/", sep = "")

path_version_data     <-
  paste(path_observations,
        params_local$Version_ID,
        "/data/",
        sep = "")

path_version_figures  <-
  paste(path_observations,
        params_local$Version_ID,
        "/figures/",
        sep = "")
```

```{r load_libraries_specific, include = FALSE}

library(purrr)
library(marelac)
library(gt)

```


```{r select_basin_mask, include=FALSE}

basinmask <- basinmask %>% 
  filter(MLR_basins == params_local$MLR_basins) %>% 
  select(-c(MLR_basins, basin))

```


# Version ID

The results displayed on this site correspond to the Version_ID: `r params$Version_ID`

# Data sources

Required are: 

- Cant from Sabine 2004 (S04)
- Cant from Gruber 2019 (G19)
- annual mean atmospheric pCO~2~ 

- Mean eMLR-Cant per grid cell (lat, lon, depth)


```{r read_cant_files}


cant_3d_ss <- read_csv(paste(path_version_data,
                             "cant_3d_tref.csv",
                             sep = ""))

cant_3d_emlr <-
  read_csv(paste(path_version_data,
                 "cant_3d.csv",
                 sep = ""))

co2_atm <-
  read_csv(paste(path_preprocessing,
                 "co2_atm.csv",
                 sep = ""))

tref <-
  read_csv(paste(path_version_data,
                 "tref.csv",
                 sep = ""))


cant_3d_mod_truth <-
  read_csv(paste(path_version_data,
                 "cant_3d_mod_truth.csv", sep = ""))

cant_3d_mod_truth_cc <-
  read_csv(paste(path_version_data,
                 "cant_3d_mod_truth_cc.csv", sep = ""))

```

# Prepare delta Cant

## Steady state

```{r prep_steady_state}

# join with basinmask
cant_3d_ss <- inner_join(cant_3d_ss, basinmask)

# calculate delta cant as the difference between total cant at tref
# this includes the G19 anomaly
cant_3d_ss <- cant_3d_ss %>%
  pivot_wider(names_from = era,
              values_from = "cant_pos") %>% 
  mutate(delta_cant_pos = !!sym(tref$era[2]) - !!sym(tref$era[1])) %>% 
  select(-c(!!sym(tref$era[2]), !!sym(tref$era[1]))) %>%
  drop_na()


```

## Model truth

```{r prep_model_truth}

cant_3d_mod_truth <- cant_3d_mod_truth %>% 
  select(lon, lat, depth, basin_AIP, delta_cant_pos = cant_pos) %>% 
  mutate(data_source = "mod_truth")

cant_3d_mod_truth_cc <- cant_3d_mod_truth_cc %>% 
  select(lon, lat, depth, basin_AIP, delta_cant_pos = cant_pos) %>% 
  mutate(data_source = "mod_truth_cc")

```

## eMLR(C*)

```{r prep_emlr}

cant_3d_emlr <- cant_3d_emlr %>% 
  select(data_source, lon, lat, depth, basin_AIP, delta_cant_pos = cant_pos)

```

# Join data

## Model

```{r join_mod_data}

cant_mod_3d <- bind_rows(
  cant_3d_emlr %>%
    filter(data_source == "mod") %>%
    select(-data_source) %>%
    mutate(estimate = "emlr"),
  cant_3d_mod_truth %>%
    filter(data_source == "mod_truth") %>%
    select(-data_source) %>%
    mutate(estimate = "mod_truth_vc"),
  cant_3d_mod_truth_cc %>%
    filter(data_source == "mod_truth_cc") %>%
    select(-data_source) %>%
    mutate(estimate = "mod_truth_cc"),
  cant_3d_ss %>%
    filter(data_source == "mod") %>%
    select(-data_source) %>%
    mutate(estimate = "ss_tss")
)

```

## Observations

```{r join_obs_data}

cant_obs_3d <- bind_rows(
  cant_3d_emlr %>% 
    filter(data_source == "obs") %>% 
    select(-data_source) %>% 
    mutate(estimate = "emlr"),
  cant_3d_ss %>% 
    filter(data_source == "obs") %>% 
    select(-data_source) %>% 
    mutate(estimate = "ss_tss")
)

```

# Model

## Bias correlation

```{r bias_correlation_mod, fig.asp=0.5}

cant_mod_3d_bias <- cant_mod_3d %>%
  pivot_wider(names_from = estimate,
              values_from = delta_cant_pos) %>%
  drop_na()


cant_mod_3d_bias <- cant_mod_3d_bias %>% 
  mutate(emlr_anom = emlr - ss_tss,
         emlr_bias = emlr - mod_truth_vc,
         nss_mod_truth = mod_truth_vc - mod_truth_cc,
         nss_projection = mod_truth_vc - ss_tss) %>% 
  select(-c(emlr:ss_tss))

axis_limit <- cant_mod_3d_bias %>% 
  pivot_longer(emlr_anom:nss_projection,
               names_to = "estimate",
               values_to = "bias") %>% 
  pull(bias) %>% 
  abs() %>% 
  max()

cant_mod_3d_bias %>%
  ggplot(aes(emlr_bias, emlr_anom)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_bin2d(binwidth = 1) +
  scale_fill_viridis_c(trans = "log10") +
  coord_equal(xlim = c(-axis_limit, axis_limit),
              ylim = c(-axis_limit, axis_limit)) +
  labs(title = "Bias vs bias plots") +
  facet_wrap( ~ basin_AIP)

cant_mod_3d_bias %>% 
  ggplot(aes(emlr_anom, nss_mod_truth)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_bin2d(binwidth = 1) +
  scale_fill_viridis_c(trans = "log10") +
  coord_equal(xlim = c(-axis_limit, axis_limit),
              ylim = c(-axis_limit, axis_limit)) +
  labs(title = "Bias vs bias plots") +
  facet_wrap(~ basin_AIP)

cant_mod_3d_bias %>% 
  ggplot(aes(nss_mod_truth, nss_projection)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_bin2d(binwidth = 1) +
  scale_fill_viridis_c(trans = "log10") +
  coord_equal(xlim = c(-axis_limit, axis_limit),
              ylim = c(-axis_limit, axis_limit)) +
  labs(title = "Bias vs bias plots") +
  facet_wrap(~ basin_AIP)

```

### Vertical patterns

```{r vertical_bias_distribution_basin, fig.asp=0.5}

cant_mod_3d_bias_profile <- cant_mod_3d_bias %>% 
  pivot_longer(emlr_anom:nss_projection,
               names_to = "estimate",
               values_to = "bias") %>% 
  group_by(depth, estimate, basin_AIP) %>% 
  summarise(bias = mean(bias)) %>% 
  ungroup()

cant_mod_3d_bias_profile %>% 
  ggplot(aes(bias, depth, col=estimate)) +
  geom_path() +
  scale_y_reverse() +
  facet_grid(~ basin_AIP)


```


```{r vertical_bias_distribution}

cant_mod_3d_bias_profile <- cant_mod_3d_bias %>% 
  pivot_longer(emlr_anom:nss_projection,
               names_to = "estimate",
               values_to = "bias") %>% 
  group_by(depth, estimate) %>% 
  summarise(bias = mean(bias)) %>% 
  ungroup()

cant_mod_3d_bias_profile %>% 
  ggplot(aes(bias, depth, col=estimate)) +
  geom_path() +
  scale_y_reverse()

rm(cant_mod_3d_bias_profile)

```



## Zonal mean sections

### delta Cant

```{r zonal_section_delta_cant_pos_mod}

# calculate zonal mean section
cant_mod_section <- cant_mod_3d %>%
  group_by(estimate) %>%
  nest() %>%
  mutate(section = map(.x = data, ~m_zonal_mean_sd(.x))) %>%
  select(-data) %>%
  unnest(section)

```

### Bias

```{r zonal_section_delta_cant_pos_bias_mod}

cant_mod_section_bias <- cant_mod_section %>%
  select(-delta_cant_pos_sd) %>% 
  pivot_wider(names_from = estimate,
              values_from = delta_cant_pos_mean) %>% 
  drop_na()


cant_mod_section_bias <- cant_mod_section_bias %>% 
  mutate(emlr_anom = emlr - ss_tss,
         emlr_bias = emlr - mod_truth_vc,
         nss_mod_truth = mod_truth_vc - mod_truth_cc,
         nss_projection = mod_truth_vc - ss_tss) %>% 
  select(-c(emlr:ss_tss))

cant_mod_section_bias_long <- cant_mod_section_bias %>% 
  pivot_longer(emlr_anom:nss_projection,
               names_to = "estimate",
               values_to = "delta_cant_pos_bias")
  


cant_mod_section_bias_long %>% 
  group_by(basin_AIP, estimate) %>%
  group_split() %>% 
  # head(1) %>%
  map( ~ p_section_zonal(
    df = .x,
    var = "delta_cant_pos_bias",
    col = "divergent",
    breaks = params_global$breaks_cant_offset,
    plot_slabs = "n",
    subtitle_text = paste("Basin:", .x$basin_AIP, "| Estimate:", .x$estimate)
  ))

axis_limit <- cant_mod_section_bias %>% 
  pivot_longer(emlr_anom:nss_projection,
               names_to = "estimate",
               values_to = "bias") %>% 
  pull(bias) %>% 
  abs() %>% 
  max()

cant_mod_section_bias %>%
  ggplot(aes(emlr_bias, emlr_anom)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_bin2d(binwidth = 1) +
  scale_fill_viridis_c(trans = "log10") +
  coord_equal(xlim = c(-axis_limit, axis_limit),
              ylim = c(-axis_limit, axis_limit)) +
  labs(title = "Bias vs bias plots") +
  facet_wrap( ~ basin_AIP)

cant_mod_section_bias %>% 
  ggplot(aes(emlr_anom, nss_mod_truth)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_bin2d(binwidth = 1) +
  scale_fill_viridis_c(trans = "log10") +
  coord_equal(xlim = c(-axis_limit, axis_limit),
              ylim = c(-axis_limit, axis_limit)) +
  labs(title = "Bias vs bias plots") +
  facet_wrap(~ basin_AIP)

cant_mod_section_bias %>% 
  ggplot(aes(nss_mod_truth, nss_projection)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_bin2d(binwidth = 1) +
  scale_fill_viridis_c(trans = "log10") +
  coord_equal(xlim = c(-axis_limit, axis_limit),
              ylim = c(-axis_limit, axis_limit)) +
  labs(title = "Bias vs bias plots") +
  facet_wrap(~ basin_AIP)

```


## Inventories

### delta Cant

```{r inventory_delta_cant_pos_mod, fig.asp = 0.5}

# calculate zonal mean section
cant_mod_inv <- cant_mod_3d %>%
  rename(cant_pos = delta_cant_pos) %>% 
  mutate(cant = 0,
         eras = "blank") %>% 
  group_by(estimate) %>%
  nest() %>%
  mutate(inv = map(.x = data, ~m_cant_inv(.x))) %>%
  select(-data) %>%
  unnest(inv) %>% 
  select(-c(cant_inv, eras))

```

### Bias

```{r inventory_delta_cant_pos_bias_mod}

cant_mod_inv_bias <- cant_mod_inv %>%
  filter(inv_depth == params_global$inventory_depth_standard) %>% 
  select(-inv_depth) %>% 
  pivot_wider(names_from = estimate,
              values_from = cant_pos_inv) %>% 
  drop_na()


cant_mod_inv_bias <- cant_mod_inv_bias %>% 
  mutate(emlr_anom = emlr - ss_tss,
         emlr_bias = emlr - mod_truth_vc,
         nss_mod_truth = mod_truth_vc - mod_truth_cc,
         nss_projection = mod_truth_vc - ss_tss) %>% 
  select(-c(emlr:ss_tss))


cant_mod_inv_bias_long <- cant_mod_inv_bias %>% 
  pivot_longer(emlr_anom:nss_projection,
               values_to = "cant_pos_inv_bias",
               names_to = "estimate")
  


cant_mod_inv_bias_long %>% 
  group_by(estimate) %>%
  group_split() %>% 
  # head(1) %>%
  map( ~ p_map_cant_inv_offset(
    df = .x,
    var = "cant_pos_inv_bias",
    subtitle_text = paste("Estimate:", .x$estimate)
  ))


axis_limit <- cant_mod_inv_bias %>% 
  pivot_longer(emlr_anom:nss_projection,
               names_to = "estimate",
               values_to = "bias") %>% 
  pull(bias) %>% 
  abs() %>% 
  max()

cant_mod_inv_bias %>%
  ggplot(aes(emlr_bias, emlr_anom)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_bin2d(binwidth = 1) +
  scale_fill_viridis_c(trans = "log10") +
  coord_equal(xlim = c(-axis_limit, axis_limit),
              ylim = c(-axis_limit, axis_limit)) +
  labs(title = "Bias vs bias plots") +
  facet_wrap( ~ basin_AIP)

cant_mod_inv_bias %>% 
  ggplot(aes(emlr_anom, nss_mod_truth)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_bin2d(binwidth = 1) +
  scale_fill_viridis_c(trans = "log10") +
  coord_equal(xlim = c(-axis_limit, axis_limit),
              ylim = c(-axis_limit, axis_limit)) +
  labs(title = "Bias vs bias plots") +
  facet_wrap(~ basin_AIP)

cant_mod_inv_bias %>% 
  ggplot(aes(nss_mod_truth, nss_projection)) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = 0) +
  geom_bin2d(binwidth = 1) +
  scale_fill_viridis_c(trans = "log10") +
  coord_equal(xlim = c(-axis_limit, axis_limit),
              ylim = c(-axis_limit, axis_limit)) +
  labs(title = "Bias vs bias plots") +
  facet_wrap(~ basin_AIP)

```


## Budgets

```{r calculate_global_inventory_mod}

cant_mod_inv_budget <- cant_mod_inv %>% 
  mutate(surface_area = earth_surf(lat, lon),
         # cant_inv_grid = cant_inv*surface_area,
         cant_pos_inv_grid = cant_pos_inv*surface_area) %>% 
  group_by(basin_AIP, estimate, inv_depth) %>% 
  summarise(#cant_total = sum(cant_inv_grid)*12*1e-15,
            #cant_total = round(cant_total,1),
            cant_pos_total = sum(cant_pos_inv_grid)*12*1e-15,
            cant_pos_total = round(cant_pos_total,1)) %>% 
  ungroup()

duration <- sort(tref$median_year)[2] - sort(tref$median_year)[1]

cant_mod_inv_budget %>%  
  group_by(estimate, inv_depth) %>% 
  summarise(#cant_total = sum(cant_total),
            #cant_total = round(cant_total,1),
            cant_pos_total = sum(cant_pos_total),
            cant_pos_total = round(cant_pos_total,1),
            #cant_total_rate = cant_total / duration,
            cant_pos_total_rate = cant_pos_total / duration) %>% 
  ungroup()


```

### Standard depth

Results integrated over the upper `r params_global$inventory_depth_standard` m

```{r cant_budget_standard_depth_mod}

cant_mod_inv_budget %>%
  filter(inv_depth == params_global$inventory_depth_standard) %>% 
  ggplot(aes(estimate, cant_pos_total, fill = basin_AIP)) +
  scale_fill_brewer(palette = "Dark2") +
  geom_col()

cant_mod_inv_budget %>%
  filter(inv_depth == params_global$inventory_depth_standard) %>% 
  gt(rowname_col = "basin_AIP",
     groupname_col = c("estimate", "inv_depth"),
     row_group.sep = " | Depth: ") %>% 
  summary_rows(
    groups = TRUE,
    fns = list(total = "sum")
  )


```

### Other depths

Results integrated over the upper `r params_global$inventory_depths` m

```{r cant_budget_other_depth_mod, fig.asp=1.5}

cant_mod_inv_budget %>%
  filter(inv_depth != params_global$inventory_depth_standard) %>% 
  ggplot(aes(estimate, cant_pos_total, fill = basin_AIP)) +
  scale_fill_brewer(palette = "Dark2") +
  geom_col() +
  facet_grid(inv_depth ~ ., scales = "free_y")

cant_mod_inv_budget %>%
  filter(inv_depth != params_global$inventory_depth_standard) %>% 
  gt(rowname_col = "basin_AIP",
     groupname_col = c("estimate", "inv_depth"),
     row_group.sep = " | Depth: ") %>% 
  summary_rows(
    groups = TRUE,
    fns = list(total = "sum")
  )

```


# Observations

## Zonal mean sections

### delta Cant

```{r zonal_section_delta_cant_pos_obs}

# calculate zonal mean section
cant_obs_section <- cant_obs_3d %>%
  group_by(estimate) %>%
  nest() %>%
  mutate(section = map(.x = data, ~m_zonal_mean_sd(.x))) %>%
  select(-data) %>%
  unnest(section)

```

### Bias

```{r zonal_section_delta_cant_pos_bias_obs}

cant_obs_section_bias <- cant_obs_section %>%
  select(-delta_cant_pos_sd) %>% 
  pivot_wider(names_from = estimate,
              values_from = delta_cant_pos_mean) %>% 
  drop_na()


cant_obs_section_bias <- cant_obs_section_bias %>% 
  mutate(emlr_anom = emlr - ss_tss) %>% 
  select(-c(emlr:ss_tss))

cant_obs_section_bias_long <- cant_obs_section_bias %>% 
  pivot_longer(emlr_anom,
               names_to = "estimate",
               values_to = "delta_cant_pos_bias")
  


cant_obs_section_bias_long %>% 
  group_by(basin_AIP, estimate) %>%
  group_split() %>% 
  # head(1) %>%
  map( ~ p_section_zonal(
    df = .x,
    var = "delta_cant_pos_bias",
    col = "divergent",
    breaks = params_global$breaks_cant_offset,
    plot_slabs = "n",
    subtitle_text = paste("Basin:", .x$basin_AIP, "| Estimate:", .x$estimate)
  ))
```


## Inventories

### delta Cant

```{r inventory_delta_cant_pos_obs, fig.asp = 0.5}

# calculate zonal mean section
cant_obs_inv <- cant_obs_3d %>%
  rename(cant_pos = delta_cant_pos) %>% 
  mutate(cant = 0,
         eras = "blank") %>% 
  group_by(estimate) %>%
  nest() %>%
  mutate(inv = map(.x = data, ~m_cant_inv(.x))) %>%
  select(-data) %>%
  unnest(inv) %>% 
  select(-c(cant_inv, eras))

```

### Bias

```{r inventory_delta_cant_pos_bias_obs}

cant_obs_inv_bias <- cant_obs_inv %>%
  filter(inv_depth == params_global$inventory_depth_standard) %>% 
  select(-inv_depth) %>% 
  pivot_wider(names_from = estimate,
              values_from = cant_pos_inv) %>% 
  drop_na()


cant_obs_inv_bias <- cant_obs_inv_bias %>% 
  mutate(emlr_anom = emlr - ss_tss) %>% 
  select(-c(emlr:ss_tss))


cant_obs_inv_bias_long <- cant_obs_inv_bias %>% 
  pivot_longer(emlr_anom,
               values_to = "cant_pos_inv_bias",
               names_to = "estimate")
  


cant_obs_inv_bias_long %>% 
  group_by(estimate) %>%
  group_split() %>% 
  # head(1) %>%
  map( ~ p_map_cant_inv_offset(
    df = .x,
    var = "cant_pos_inv_bias",
    subtitle_text = paste("Estimate:", .x$estimate)
  ))



```


## Budgets

```{r calculate_global_inventory_obs}

cant_obs_inv_budget <- cant_obs_inv %>% 
  mutate(surface_area = earth_surf(lat, lon),
         # cant_inv_grid = cant_inv*surface_area,
         cant_pos_inv_grid = cant_pos_inv*surface_area) %>% 
  group_by(basin_AIP, estimate, inv_depth) %>% 
  summarise(#cant_total = sum(cant_inv_grid)*12*1e-15,
            #cant_total = round(cant_total,1),
            cant_pos_total = sum(cant_pos_inv_grid)*12*1e-15,
            cant_pos_total = round(cant_pos_total,1)) %>% 
  ungroup()

duration <- sort(tref$median_year)[2] - sort(tref$median_year)[1]

cant_obs_inv_budget %>%  
  group_by(estimate, inv_depth) %>% 
  summarise(#cant_total = sum(cant_total),
            #cant_total = round(cant_total,1),
            cant_pos_total = sum(cant_pos_total),
            cant_pos_total = round(cant_pos_total,1),
            #cant_total_rate = cant_total / duration,
            cant_pos_total_rate = cant_pos_total / duration) %>% 
  ungroup()


```

### Standard depth

Results integrated over the upper `r params_global$inventory_depth_standard` m

```{r cant_budget_standard_depth_obs}

cant_obs_inv_budget %>%
  filter(inv_depth == params_global$inventory_depth_standard) %>% 
  ggplot(aes(estimate, cant_pos_total, fill = basin_AIP)) +
  scale_fill_brewer(palette = "Dark2") +
  geom_col()

cant_obs_inv_budget %>%
  filter(inv_depth == params_global$inventory_depth_standard) %>% 
  gt(rowname_col = "basin_AIP",
     groupname_col = c("estimate", "inv_depth"),
     row_group.sep = " | Depth: ") %>% 
  summary_rows(
    groups = TRUE,
    fns = list(total = "sum")
  )


```

### Other depths

Results integrated over the upper `r params_global$inventory_depths` m

```{r cant_budget_other_depth_obs, fig.asp=1.5}

cant_obs_inv_budget %>%
  filter(inv_depth != params_global$inventory_depth_standard) %>% 
  ggplot(aes(estimate, cant_pos_total, fill = basin_AIP)) +
  scale_fill_brewer(palette = "Dark2") +
  geom_col() +
  facet_grid(inv_depth ~ ., scales = "free_y")

cant_obs_inv_budget %>%
  filter(inv_depth != params_global$inventory_depth_standard) %>% 
  gt(rowname_col = "basin_AIP",
     groupname_col = c("estimate", "inv_depth"),
     row_group.sep = " | Depth: ") %>% 
  summary_rows(
    groups = TRUE,
    fns = list(total = "sum")
  )


```

# Write files

```{r write_csv}

cant_mod_3d_bias %>%
  write_csv(paste0(path_version_data,
                   "anom_cant_mod_3d_bias.csv"))

cant_mod_section_bias %>%
  write_csv(paste0(path_version_data,
                   "anom_cant_mod_section_bias.csv"))

cant_mod_inv_bias %>%
  write_csv(paste0(path_version_data,
                   "anom_cant_mod_inv_bias.csv"))

cant_mod_inv_budget %>%
  write_csv(paste0(path_version_data,
                   "anom_cant_mod_inv_budget.csv"))


cant_obs_section_bias %>%
  write_csv(paste0(path_version_data,
                   "anom_cant_obs_section_bias.csv"))

cant_obs_inv_bias %>%
  write_csv(paste0(path_version_data,
                   "anom_cant_obs_inv_bias.csv"))

cant_obs_inv_budget %>%
  write_csv(paste0(path_version_data,
                   "anom_cant_obs_inv_budget.csv"))

```

